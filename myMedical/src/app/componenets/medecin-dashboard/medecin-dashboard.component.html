<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="logo">
      <span class="logo-icon">ğŸ¥</span>
      <span class="logo-text">Cabinet Dentaire Smile</span>
    </div>
    <div class="user-info">
      <span>Bienvenue, Dr. {{ authService.getUsername() }}</span>
      <button class="btn btn-outline" (click)="logout()">DÃ©connexion</button>
    </div>
  </header>

  <!-- Stats Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <span class="stat-icon">ğŸ“…</span>
      <div class="stat-info">
        <span class="stat-value">{{ stats.total }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>
    <div class="stat-card stat-pending">
      <span class="stat-icon">â³</span>
      <div class="stat-info">
        <span class="stat-value">{{ stats.pending }}</span>
        <span class="stat-label">En attente</span>
      </div>
    </div>
    <div class="stat-card stat-confirmed">
      <span class="stat-icon">âœ…</span>
      <div class="stat-info">
        <span class="stat-value">{{ stats.accepted }}</span>
        <span class="stat-label">ConfirmÃ©s</span>
      </div>
    </div>
    <div class="stat-card stat-completed">
      <span class="stat-icon">ğŸ†</span>
      <div class="stat-info">
        <span class="stat-value">{{ stats.completed }}</span>
        <span class="stat-label">TerminÃ©s</span>
      </div>
    </div>
  </div>

  <!-- Alert Messages -->
  <div class="alert alert-error" *ngIf="error">
    {{ error }}
  </div>
  <div class="alert alert-success" *ngIf="success">
    {{ success }}
  </div>

  <!-- Navigation Tabs -->
  <nav class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'pending'"
      (click)="setActiveTab('pending')">
      â³ En attente ({{ stats.pending }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'accepted'"
      (click)="setActiveTab('accepted')">
      âœ… ConfirmÃ©s ({{ stats.accepted }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'completed'"
      (click)="setActiveTab('completed')">
      ğŸ† TerminÃ©s ({{ stats.completed }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'all'"
      (click)="setActiveTab('all')">
      ğŸ“‹ Tous ({{ stats.total }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'patients'"
      (click)="setActiveTab('patients')">
      ğŸ‘¥ Patients
    </button>
  </nav>

  <!-- Appointments List -->
  <section class="appointments-section" *ngIf="activeTab !== 'patients'">
    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      <p>Chargement...</p>
    </div>

    <div class="appointments-list" *ngIf="!loading">
      <div class="appointment-card" *ngFor="let apt of getFilteredAppointments()" [class]="getStatusClass(apt.status)">
        <div class="appointment-header">
          <div class="patient-info">
            <span class="patient-avatar">ğŸ‘¤</span>
            <div>
              <h3>{{ apt.patientUsername }}</h3>
              <span class="appointment-id">#{{ apt.id }}</span>
            </div>
          </div>
          <span class="status-badge" [class]="getStatusClass(apt.status)">
            {{ getStatusLabel(apt.status) }}
          </span>
        </div>

        <div class="appointment-details">
          <div class="detail-row">
            <span class="icon">ğŸ“…</span>
            <span>{{ formatDate(apt.appointmentDate) }}</span>
          </div>
          <div class="detail-row" *ngIf="apt.reason">
            <span class="icon">ğŸ“</span>
            <span>{{ apt.reason }}</span>
          </div>
        </div>

        <div class="appointment-actions" *ngIf="isPending(apt.status)">
          <button class="btn btn-success" (click)="acceptAppointment(apt)">
            âœ… Accepter
          </button>
          <button class="btn btn-danger" (click)="rejectAppointment(apt)">
            âŒ Refuser
          </button>
          <button class="btn btn-primary" (click)="openCreatePatientFileForm(apt.patientId)">
            ğŸ“‹ CrÃ©er dossier
          </button>
        </div>

        <div class="appointment-actions" *ngIf="isConfirmed(apt.status)">
          <button class="btn btn-primary" (click)="completeAppointment(apt)">
            ğŸ† Marquer comme terminÃ©
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="getFilteredAppointments().length === 0">
        <span class="empty-icon">ğŸ“…</span>
        <p>Aucun rendez-vous dans cette catÃ©gorie.</p>
      </div>
    </div>
  </section>

  <!-- Patient Files List -->
  <section class="patient-files-section" *ngIf="activeTab === 'patients'">
    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      <p>Chargement...</p>
    </div>

    <div class="patient-files-list" *ngIf="!loading">
      <div class="patient-file-card" *ngFor="let file of patientFiles">
        <div class="patient-file-header">
          <span class="patient-avatar">ğŸ‘¤</span>
          <div>
            <h3>{{ file.firstName }} {{ file.lastName }}</h3>
            <span class="patient-username">{{ file.patientId }}</span>
          </div>
        </div>
        <div class="patient-file-details">
          <div class="detail-row" *ngIf="file.bloodType">
            <span class="icon">ğŸ©¸</span>
            <span>Groupe sanguin: {{ file.bloodType }}</span>
          </div>
          <div class="detail-row" *ngIf="file.allergies">
            <span class="icon">âš ï¸</span>
            <span>Allergies: {{ file.allergies }}</span>
          </div>
          <div class="detail-row" *ngIf="file.dentalHistory">
            <span class="icon">ğŸ¦·</span>
            <span>Historique dental: {{ file.dentalHistory }}</span>
          </div>
        </div>
        <div class="patient-file-actions">
          <button class="btn btn-primary" (click)="editPatientFile(file)">
            âœï¸ Modifier
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="patientFiles.length === 0">
        <span class="empty-icon">ğŸ‘¥</span>
        <p>Aucun dossier patient trouvÃ©.</p>
      </div>
    </div>
  </section>

  <!-- Patient File Form Modal -->
  <div class="modal-overlay" *ngIf="showPatientFileForm" (click)="closePatientFileForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditingPatientFile ? 'Modifier le dossier patient' : 'CrÃ©er un dossier patient' }}</h2>
        <button class="close-btn" (click)="closePatientFileForm()">Ã—</button>
      </div>

      <div class="modal-body">
        <div class="form-section">
          <h3>Informations personnelles</h3>
          <div class="form-row">
            <div class="form-group">
              <label>PrÃ©nom</label>
              <input type="text" [(ngModel)]="patientFileForm.firstName" placeholder="PrÃ©nom">
            </div>
            <div class="form-group">
              <label>Nom</label>
              <input type="text" [(ngModel)]="patientFileForm.lastName" placeholder="Nom">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Date de naissance</label>
              <input type="date" [(ngModel)]="patientFileForm.dateOfBirth">
            </div>
            <div class="form-group">
              <label>Genre</label>
              <select [(ngModel)]="patientFileForm.gender">
                <option value="">SÃ©lectionner</option>
                <option value="M">Masculin</option>
                <option value="F">FÃ©minin</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>TÃ©lÃ©phone</label>
              <input type="tel" [(ngModel)]="patientFileForm.phone" placeholder="TÃ©lÃ©phone">
            </div>
            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="patientFileForm.email" placeholder="Email">
            </div>
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <textarea [(ngModel)]="patientFileForm.address" placeholder="Adresse" rows="2"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h3>Informations mÃ©dicales</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Groupe sanguin</label>
              <select [(ngModel)]="patientFileForm.bloodType">
                <option value="">SÃ©lectionner</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            <div class="form-group">
              <label>MÃ©dicaments actuels</label>
              <input type="text" [(ngModel)]="patientFileForm.currentMedications" placeholder="MÃ©dicaments actuels">
            </div>
          </div>
          <div class="form-group">
            <label>Allergies</label>
            <textarea [(ngModel)]="patientFileForm.allergies" placeholder="Allergies" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>AntÃ©cÃ©dents mÃ©dicaux</label>
            <textarea [(ngModel)]="patientFileForm.medicalHistory" placeholder="AntÃ©cÃ©dents mÃ©dicaux" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>AntÃ©cÃ©dents familiaux</label>
            <textarea [(ngModel)]="patientFileForm.familyMedicalHistory" placeholder="AntÃ©cÃ©dents familiaux" rows="2"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h3>Informations dentaires</h3>
          <div class="form-group">
            <label>Historique dental</label>
            <textarea [(ngModel)]="patientFileForm.dentalHistory" placeholder="Historique dental" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>ProblÃ¨mes dentaires actuels</label>
            <textarea [(ngModel)]="patientFileForm.currentDentalIssues" placeholder="ProblÃ¨mes actuels" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>Traitements prÃ©cÃ©dents</label>
            <textarea [(ngModel)]="patientFileForm.previousTreatments" placeholder="Traitements prÃ©cÃ©dents" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>Notes dentaires</label>
            <textarea [(ngModel)]="patientFileForm.dentalNotes" placeholder="Notes dentaires" rows="2"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h3>Notes de consultation</h3>
          <div class="form-group">
            <textarea [(ngModel)]="patientFileForm.consultationNotes" placeholder="Notes de consultation" rows="4"></textarea>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" (click)="closePatientFileForm()">Annuler</button>
        <button class="btn btn-primary" (click)="savePatientFile()" [disabled]="loading">
          {{ loading ? 'Enregistrement...' : (isEditingPatientFile ? 'Mettre Ã  jour' : 'CrÃ©er') }}
        </button>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="back-section">
    <button class="btn btn-outline" (click)="goToAuth()">
      â† Retour Ã  la page d'authentification
    </button>
  </div>
</div>
